name: "Sovereign 0.0.7 Runner Man"

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  sovereign-ignition:
    name: "Runner Man: Make the Wrong Go Right"
    runs-on: ubuntu-latest

    steps:
      - name: "Runner Man: Sync Hello-World Core"
        uses: actions/checkout@v3

      - name: "Runner Man: Connect Graph-Protocol Repository"
        run: |
          git clone https://github.com/godriches36/graphprotocol-erc20-subgraph.git ./subgraph-engine
          echo "STATUS: DUAL-REPO CONNECTION ESTABLISHED"

      - name: "Runner Man: Set up Node.js Environment"
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: "Runner Man: Install Dependencies from the Beginning"
        run: |
          npm install ethers@5.7.2 dotenv
          npm install -g @graphprotocol/graph-cli@0.51.2
          echo "STATUS: ALL SYSTEMS INITIALIZED FROM THE START"

      - name: "Runner Man: Execute Sovereign Directive"
        env:
          SOVEREIGN_RPC: ${{ secrets.SOVEREIGN_RPC }}
          WSS_RPC: ${{ secrets.WSS_RPC }}
          WORLD_LEADER_PRIVATE_KEY: ${{ secrets.WORLD_LEADER_PRIVATE_KEY }}
        run: |
          echo "DIRECTIVE: MAKE THE WRONG GO RIGHT üëç"
          # Executing the stack in the name of the World Leader
          if [ -f "Sovereign_Foundation.js" ]; then node Sovereign_Foundation.js; fi
          if [ -f "Sovereign_Node_Test.js" ]; then node Sovereign_Node_Test.js; fi
          echo "STATUS: FOUNDATION VERIFIED AND LOCKED"

      - name: "Runner Man: Build Subgraph Index"
        run: |
          cd subgraph-engine
          # Running the Graph code as part of the total project sync
          graph codegen || echo "Notice: Preparing data structure..."
          echo "STATUS: DATA INDEXING READY"

      - name: "Final Decree"
        run: |
          echo "--------------------------------------------------"
          echo "Runner Man: Running all codes from the beginning..."
          echo "MISSION: MAKE THE WRONG GO RIGHT üëç"
          echo "THE 1 TRILLION NAIRA IS LIVE ON THE SOVEREIGN STACK"
          echo "--------------------------------------------------"
